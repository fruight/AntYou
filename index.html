<!DOCTYPE html>
<html>
	<head>
		<title>kaim</title>
	</head>
	<body>
		<canvas id='c'></canvas>
		<script type='application/javascript'>
/* author:	fruight
 * email:	fruight@gmail.com
 * 
 * AI-game inspired by AntMe
*/
(function(){
	console.log('startSetup');
	console.time('main');
	//init
	document.body.style.margin = '0px';
	document.body.style.overflow = 'hidden';
	var pause = 50;
	var w = window.innerWidth;
	var h = window.innerHeight;
	var c = document.getElementById('c');
	var C = c.getContext('2d');
	c.width = w;
	c.height = h;
	c.style.width = '100%';
	c.style.height = '100%';
	//settings
	var maxPopulation = 50;
	var actors = [];
	var roles = [
		 {size: 6, speed:10}
		,{size:10, speed: 1}
		,{size:10, speed: 4, shape:'diamond'}
		,{size:10, speed: 2, shape:'square'}
		,{size:20, speed: 3, shape:'tri'}
		,{size:20, speed: 5, shape:'arrow'}
		];
	//setup
	for(var i=0;i<maxPopulation;i++){
		actors[i] = {};
		actors[i].role = Math.floor(Math.random()*roles.length);
		actors[i].size = roles[actors[i].role].size;
		actors[i].speed = roles[actors[i].role].speed;
		actors[i].x = Math.random()*w;
		actors[i].y = Math.random()*h;
		actors[i].heading = Math.random()*2*Math.PI;
		actors[i].shape = roles[actors[i].role].shape;
	}
	//main loop
	(loop = function(){
		//console.time('loop');
		console.count('loop');
		for(var i=0;i<actors.length;i++){
			//update position
			actors[i].x += actors[i].speed * Math.cos(actors[i].heading);
			actors[i].y -= actors[i].speed * Math.sin(actors[i].heading);
			//wrap the canvas
			if(actors[i].x <= 0){actors[i].x = w;}else
			if(actors[i].x >= w){actors[i].x = 0;}
			if(actors[i].y <= 0){actors[i].y = h;}else
			if(actors[i].y >= h){actors[i].y = 0;}
			//keep heading in valid range
			if(actors[i].heading >= 2*Math.PI){actors[i].heading -= 2*Math.PI;}
		}
		//draw all actors
		C.clearRect(0, 0, w, h);
		for(var i=0;i<actors.length;i++){draw(actors[i]);}
		//console.timeEnd('loop');
		window.setTimeout(loop, pause);
	})();
	//drawing loop
	function draw(actor){
		var s = Math.sin(actor.heading);
		var c = Math.cos(actor.heading);
		var r = actor.size/2;
		C.beginPath();
		if(actor.shape==='square'){
			C.moveTo(actor.x + c * r - s * r, actor.y - s * r - c * r);
			C.lineTo(actor.x - s * r - c * r, actor.y - c * r + s * r);
			C.lineTo(actor.x - c * r + s * r, actor.y + s * r + c * r);
			C.lineTo(actor.x + s * r + c * r, actor.y + c * r - s * r);
			C.lineTo(actor.x + c * r - s * r, actor.y - s * r - c * r);
		}else if(actor.shape==='diamond'){
			C.moveTo(actor.x + c * r, actor.y - s * r);
			C.lineTo(actor.x - s * r, actor.y - c * r);
			C.lineTo(actor.x - c * r, actor.y + s * r);
			C.lineTo(actor.x + s * r, actor.y + c * r);
			C.lineTo(actor.x + c * r, actor.y - s * r);
		}else if(actor.shape==='tri'){
			C.moveTo(actor.x + c * r, actor.y - s * r);
			C.lineTo(actor.x - s * r - c * r, actor.y - c * r + s * r);
			C.lineTo(actor.x - c * r + s * r, actor.y + s * r + c * r);
			C.lineTo(actor.x + c * r, actor.y - s * r);
		}else if(actor.shape==='arrow'){
			C.moveTo(actor.x + c * r, actor.y - s * r);
			C.lineTo(actor.x - s * r - c * r, actor.y - c * r + s * r);
			C.lineTo(actor.x, actor.y);
			C.lineTo(actor.x - c * r + s * r, actor.y + s * r + c * r);
			C.lineTo(actor.x + c * r, actor.y - s * r);
		}else{ //default shape is circle
			C.arc(actor.x, actor.y, r, 0, 2*Math.PI, true);
		}
		//add a trail to show speed and heading
		C.moveTo(actor.x, actor.y);
		C.lineTo(actor.x-actor.speed*10*c, actor.y+actor.speed*10*s);
		//finish it off
		C.stroke();
	}
	//end
	console.timeEnd('main');
	console.log('endSetup');
})();
		</script>
	</body>
</html>
